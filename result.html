<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Káº¿t quáº£ phÃ¢n phá»‘i</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="./asset/css/result.css">
</head>
<body>

<h1>ğŸ“Š Káº¿t quáº£ Tá»‘i Æ°u PhÃ¢n phá»‘i</h1>
<div class="layout">
  <div class="left-panel">
    <div class="info-block">
      <label>ğŸ­ NhÃ  cung cáº¥p:</label>
      <span id="providerName"></span>
    </div>
    <div class="info-block">
      <label>ğŸ“ Kho cung cáº¥p:</label>
      <span id="addressC"></span>
    </div>
    <div class="info-block">
      <label>ğŸ“¦ Danh má»¥c hÃ ng hÃ³a:</label>
      <span id="dishName"></span>
    </div>
    <div class="info-block">
      <label>â° Háº¡n sá»­ dá»¥ng Ä‘áº¿n:</label>
      <span id="expiry"></span>
    </div>
    <div class="info-block">
      <label>ğŸ“ Khu vá»±c Æ°u tiÃªn:</label>
      <span id="regionName"></span>
    </div>
    <div class="info-block">
      <label>ğŸš› Chi phÃ­ Æ°á»›c tÃ­nh (km):</label>
      <span id="totalCost"></span>
    </div>

    <h3>ğŸ“Œ PhÃ¢n bá»• chi tiáº¿t</h3>
    <table>
      <thead>
        <tr>
          <th>Äá»‹a Ä‘iá»ƒm</th>
          <th>Sá»‘ ngÆ°á»i cáº§n</th>
          <th>Sá»‘ suáº¥t phÃ¢n phá»‘i</th>
        </tr>
      </thead>
      <tbody id="allocationsTable"></tbody>
    </table>
  </div>
  <div class="right-map">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const result = JSON.parse(localStorage.getItem("resultData"));
  if (!result) {
    alert("KhÃ´ng cÃ³ dá»¯ liá»‡u káº¿t quáº£!");
    throw new Error("KhÃ´ng tÃ¬m tháº¥y resultData trong localStorage.");
  }

  document.getElementById("providerName").textContent = result.providerName;
  document.getElementById("addressC").textContent = result.addressC;
  document.getElementById("dishName").textContent = result.dishName;
  document.getElementById("expiry").textContent = result.expiry;
  document.getElementById("regionName").textContent = result.regionName;
  document.getElementById("totalCost").textContent = result.totalCost + " km";

  const table = document.getElementById("allocationsTable");
  result.allocations.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.address}</td>
      <td>${item.demand}</td>
      <td><strong>${item.allocated}</strong></td>
    `;
    table.appendChild(row);
  });

  const map = L.map('map').setView([10.762622, 106.660172], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  result.allocations.forEach(loc => {
    L.marker(loc.coords).addTo(map)
      .bindPopup(`<b>${loc.address}</b><br>PhÃ¢n phá»‘i: ${loc.allocated} suáº¥t`);
  });

  if (result.routeGeometry && result.routeGeometry.length > 0) {
    const route = L.polyline(result.routeGeometry, { color: 'blue' }).addTo(map);
    map.fitBounds(route.getBounds());
  }
</script>

</body>
</html>
