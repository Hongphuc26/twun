<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>K·∫øt qu·∫£ ph√¢n ph·ªëi</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="./asset/css/result.css">
</head>
<body>

<h1>üìä K·∫øt qu·∫£ T·ªëi ∆∞u Ph√¢n ph·ªëi</h1>
<div class="layout">
  <div class="left-panel">
    <div class="info-block">
      <label>Nh√† cung c·∫•p:</label>
      <span id="providerName"></span>
    </div>
    <div class="info-block">
      <label>Kho cung c·∫•p:</label>
      <span id="addressC"></span>
    </div>
    <div class="info-block">
      <label>Danh m·ª•c h√†ng h√≥a:</label>
      <span id="dishName"></span>
    </div>
    <div class="info-block">
      <label>H·∫°n s·ª≠ d·ª•ng ƒë·∫øn:</label>
      <span id="expiry"></span>
    </div>
    <div class="info-block">
      <label>Khu v·ª±c ∆∞u ti√™n:</label>
      <span id="regionName"></span>
    </div>
    <div class="info-block">
      <label>Chi ph√≠ ∆∞·ªõc t√≠nh (km):</label>
      <span id="totalCost"></span>
    </div>

    <h3>Ph√¢n b·ªï chi ti·∫øt</h3>
    <table>
      <thead>
        <tr>
          <th>ƒê·ªãa ƒëi·ªÉm</th>
          <th>S·ªë ng∆∞·ªùi c·∫ßn</th>
          <th>S·ªë su·∫•t ph√¢n ph·ªëi</th>
        </tr>
      </thead>
      <tbody id="allocationsTable"></tbody>
    </table>
  </div>
  <div class="right-map">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const result = JSON.parse(localStorage.getItem("resultData"));
  if (!result) {
    alert("Kh√¥ng c√≥ d·ªØ li·ªáu k·∫øt qu·∫£!");
    throw new Error("Kh√¥ng t√¨m th·∫•y resultData trong localStorage.");
  }

  document.getElementById("providerName").textContent = result.providerName;
  document.getElementById("addressC").textContent = result.addressC;
  document.getElementById("dishName").textContent = result.dishName;
  document.getElementById("expiry").textContent = result.expiry;
  document.getElementById("regionName").textContent = result.regionName;
  document.getElementById("totalCost").textContent = result.totalCost + " km";

  const table = document.getElementById("allocationsTable");
  result.allocations.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.address}</td>
      <td>${item.demand}</td>
      <td><strong>${item.allocated}</strong></td>
    `;
    table.appendChild(row);
  });

  const map = L.map('map').setView([10.762622, 106.660172], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  result.allocations.forEach(loc => {
    L.marker(loc.coords).addTo(map)
      .bindPopup(`<b>${loc.address}</b><br>Ph√¢n ph·ªëi: ${loc.allocated} su·∫•t`);
  });

  if (result.routeGeometry && result.routeGeometry.length > 0) {
    const route = L.polyline(result.routeGeometry, { color: 'blue' }).addTo(map);
    map.fitBounds(route.getBounds());
  }
</script>

</body>
</html>
